<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2023 Global Country Development & Prosperity Index</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }
      #map {
        width: 100vw;
        height: 100vh;
      }
      .country {
        stroke: #fff;
        stroke-width: 0.5px;
      }
      .tooltip {
        position: absolute;
        background: white;
        border: 1px solid #ddd;
        padding: 10px;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      const width = window.innerWidth;
      const height = window.innerHeight;

      const svg = d3.select('#map').append('svg').attr('width', width).attr('height', height);

      const projection = d3
        .geoNaturalEarth1()
        .scale(width / 2 / Math.PI)
        .translate([width / 2, height / 2]);

      const path = d3.geoPath().projection(projection);

      const colorScale = d3.scaleSequential(d3.interpolateGreens).domain([0, 100]);

      const tooltip = d3.select('body').append('div').attr('class', 'tooltip').style('opacity', 0);

      Promise.all([
        d3.json('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json'),
        d3.csv('./data/country_posperity.csv'),
      ]).then(([world, data]) => {
        const countryData = new Map(data.map((d) => [d.Country, parseFloat(+d.AverageScore)]));
        console.log(countryData);
        svg
          .selectAll('path')
          .data(topojson.feature(world, world.objects.countries).features)
          .enter()
          .append('path')
          .attr('d', path)
          .attr('class', 'country')
          .attr('fill', (d) => {
            const score = countryData.get(d.properties.name);
            return score ? colorScale(score) : '#ccc';
          })
          .on('mouseover', (event, d) => {
            const score = countryData.get(d.properties.name);
            tooltip.transition().duration(200).style('opacity', 0.9);
            tooltip
              .html(`${d.properties.name}: ${score ? score.toFixed(2) : 'N/A'}`)
              .style('left', event.pageX + 'px')
              .style('top', event.pageY - 28 + 'px');
          })
          .on('mouseout', () => {
            tooltip.transition().duration(500).style('opacity', 0);
          });
      });
    </script>
  </body>
</html>
